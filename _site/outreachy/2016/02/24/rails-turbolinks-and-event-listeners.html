<!DOCTYPE html>
<html>
  <div class='container'>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Rails, Turbolinks, and Event Listeners</title>
  <meta name="description" content=" A few weeks ago, I was happily puttering along making my accordion menu for the new Field Papers UI, when Ian pointed out that it sporadically wasn't workin...">

  <link href='https://fonts.googleapis.com/css?family=Over+the+Rainbow|Old+Standard+TT' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="canonical" href="http://linzjax.github.io/outreachy/2016/02/24/rails-turbolinks-and-event-listeners.html">
  <link rel="alternate" type="application/rss+xml" title="LinzJax:" href="http://linzjax.github.io/feed.xml" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
</head>


  <body>

    <header class="site-header">
  <div class="wrapper">

    <div class='banner-image'></div>
    
    <nav class="site-nav">
      <div class="trigger">
        <a class="page-link" href="#projects">Projects</a>
        <a class="page-link" href="#blog">Blog</a>
        <a class="page-link" href="#about">About</a>
        <a class="page-link" href="#contact">Contact</a>
      </div>
    </nav>

            <div class="post-title">
      <a  href="#">
        <h1>Rails, Turbolinks, and Event Listeners</h1>
        </a>
            <!-- <h1 class="post-title"></h1> -->
        <p class="post-meta">Feb 24, 2016 • Lindsey Jacks</p>
        <!-- <p>Front-End Developer</p>
        <p>Potentially Coherent</p> -->
      </div>
    </div>
    </a>
</header>

    <div class="page-content">
    <div class="wrapper">
		<div class="post">

		  

		  <article class="post-content">
		    <p>I finally learned to spell a-c-c-o-r-d-i-o-n. A few weeks ago, I was happily puttering along making my accordion menu for the new Field Papers UI (cue “oohs and aaahs”), when Ian pointed out that it sporadically wasn’t working. The menu items wouldn’t allow you to click on them, but refreshing the page seemed to fix it. After determining that this was indeed a bit odd, I set about to find a solution.</p>

<p>After a bit more investigating, I determined that it only occurred when you started from a different page and then clicked on a link to the compose page. For example, I enter through the home url, click “Make an atlas”, and click forlornly on non-responsive accordion menus. Refresh the page, and triumphantly click on beautifully responsive accordion menus. This was a less than ideal situation, so after gathering evidence I discovered the culprit: <a href="https://github.com/turbolinks/turbolinks">Turbolinks</a>.</p>

<p>Turbolinks is a Rails plugin that allows your rails app to behave like a single page application, and only loads the JavaScript and CSS once, instead of between each page change. In most circumstances, this would be fantastic. Faster load times, happier visitors, everyone wins.</p>

<p><strong>BUT</strong></p>

<p>The problem that I was running into is that since Turbolinks runs all of the JavaScript files once, and only once, my poor event listeners were trying to find objects that didn’t exist and giving up hope after the first page load. This explains why it worked when you refreshed the page, but didn’t work when you started somewhere else.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$(document).on("ready", function(){
   //sad code that never happens :(
});
</code></pre>
</div>

<p>Thankfully, once the culprit was identified, the fix was rather simple. Turbolinks has its own events, so instead of <em>ready</em> we listen for <em>page:change</em>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$(document).on("page:change", function(){
   //happy code that's executed every time you go to a new page :D
});
</code></pre>
</div>

<p>Another option is to disable Turbolinks in all of the connecting <code class="highlighter-rouge">&lt;a&gt;</code> tags.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;a data-no-turbolink="true" href="&lt;%= compose_path %&gt;"&gt;
</code></pre>
</div>

<p>And voila! Your JavaScript and CSS are reloaded only on the important pages.</p>

		  </article>

          
<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//linzjax.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


		</div>

      </div>
    </div>
    
    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer">
      <div class='footer-social'>
        
      <a href="https://github.com/linzjax">
        <i class='fa fa-github-square fa-3x'></i>
      </a>
      
      
      <a href="https://twitter.com/linzjax">
        <i class='fa fa-twitter-square fa-3x'></i>
        </a>
      
      
      <a href="https://instagram.com/linzjaxx">
        <i class='fa fa-instagram fa-3x'></i>
      </a>
      
    </div>
    <div class='footer-rights'>
      <p class="footer-heading"><i class='fa fa-copyright'></i>Lindsey Jacks 2016 - <a href='#{ site.email }'>linzjax@gmail.com</a></p>
    </div>
  </div>
  <script type="text/javascript" src="/assets/javascripts/lightbox.js"></script>
  
</footer>


  </body>
</div>
</html>
